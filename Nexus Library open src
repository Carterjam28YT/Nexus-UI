-- Nexus UI Library
local NexusUI = {}
NexusUI.__index = NexusUI

function NexusUI:Init(config)
    config = config or {}
    self.KeySystemEnabled = config.KeySystem or false
    self.Keys = config.Keys or {}
    self.GetKeyLink = config.GetKeyLink or ""
    self.DiscordInvite = config.DiscordInvite or ""
    self.Windows = {}
    self.Verified = not self.KeySystemEnabled
    return self
end

-- Utility function
local function CreateInstance(class, props, parent)
    local inst = Instance.new(class)
    for k,v in pairs(props or {}) do
        inst[k] = v
    end
    if parent then
        inst.Parent = parent
    end
    return inst
end

-- Notification
function NexusUI:ShowNotification(data)
    data = data or {}
    local title = data.Title or "Title"
    local msg = data.Message or "Message"
    local duration = data.Duration or 3

    local screenGui = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    local frame = CreateInstance("Frame",{
        Size = UDim2.new(0,300,0,100),
        BackgroundColor3 = Color3.fromRGB(85,0,255),
        AnchorPoint = Vector2.new(0.5,0.5),
        Position = UDim2.new(0.5,0,0.3,0),
        BackgroundTransparency = 0.1,
        ClipsDescendants = true,
        Parent = screenGui
    })

    local titleLabel = CreateInstance("TextLabel",{
        Text = title,
        Font = Enum.Font.SourceSansBold,
        TextSize = 20,
        TextColor3 = Color3.fromRGB(255,255,255),
        BackgroundTransparency = 1,
        Size = UDim2.new(1,0,0.4,0),
        Parent = frame
    })

    local msgLabel = CreateInstance("TextLabel",{
        Text = msg,
        Font = Enum.Font.SourceSans,
        TextSize = 16,
        TextColor3 = Color3.fromRGB(255,255,255),
        BackgroundTransparency = 1,
        Size = UDim2.new(1,0,0.6,0),
        Position = UDim2.new(0,0,0.4,0),
        Parent = frame
    })

    spawn(function()
        task.wait(duration)
        frame:Destroy()
    end)
end

-- Create Window
function NexusUI:CreateWindow(data)
    local data = data or {}
    local player = game:GetService("Players").LocalPlayer
    local screenGui = CreateInstance("ScreenGui",{Parent = player:WaitForChild("PlayerGui")})

    local window = CreateInstance("Frame",{
        Size = UDim2.new(0,500,0,400),
        BackgroundColor3 = Color3.fromRGB(85,0,255),
        Position = UDim2.new(0.5,-250,0.3,-200),
        AnchorPoint = Vector2.new(0.5,0.5),
        Parent = screenGui
    })

    -- Top bar (draggable)
    local topBar = CreateInstance("Frame",{
        Size = UDim2.new(1,0,0,30),
        BackgroundColor3 = Color3.fromRGB(60,0,200),
        Parent = window
    })

    local drag = false
    local dragInput, mousePos, framePos
    topBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            drag = true
            mousePos = input.Position
            framePos = window.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    drag = false
                end
            end)
        end
    end)
    topBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input == dragInput and drag then
            local delta = input.Position - mousePos
            window.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X,
                                        framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)

    -- Close button
    local closeBtn = CreateInstance("TextButton",{
        Text = "X",
        BackgroundColor3 = Color3.fromRGB(200,0,0),
        TextColor3 = Color3.new(1,1,1),
        Size = UDim2.new(0,30,0,30),
        Position = UDim2.new(1,-30,0,0),
        Parent = topBar
    })
    closeBtn.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    -- Discord Button
    if data.Discord then
        local discordBtn = CreateInstance("TextButton",{
            Text = "Discord",
            BackgroundColor3 = Color3.fromRGB(0,0,0),
            TextColor3 = Color3.new(1,1,1),
            Size = UDim2.new(0,100,0,25),
            Position = UDim2.new(0.5,-50,0,2.5),
            Parent = topBar
        })
        discordBtn.MouseButton1Click:Connect(function()
            setclipboard(self.DiscordInvite)
            self:ShowNotification({Title="Copied!", Message="Discord invite copied to clipboard.", Duration=2})
        end)
    end

    local windowObj = {
        ScreenGui = screenGui,
        WindowFrame = window,
        Tabs = {}
    }

    function windowObj:CreateTab(name)
        local tab = {Name=name, Sections={}}
        table.insert(windowObj.Tabs, tab)
        return {
            CreateSection = function(_, secName)
                local section = {Name=secName, Elements={}}
                table.insert(tab.Sections, section)
                return {
                    CreateButton = function(_, info)
                        table.insert(section.Elements,{Type="Button",Data=info})
                        -- Bind callback
                        info.Callback = info.Callback or function() end
                    end,
                    CreateToggle = function(_, info)
                        table.insert(section.Elements,{Type="Toggle",Data=info})
                        info.Callback = info.Callback or function(state) end
                    end,
                    CreateSlider = function(_, info)
                        table.insert(section.Elements,{Type="Slider",Data=info})
                        info.Callback = info.Callback or function(value) end
                    end
                }
            end
        }
    end

    table.insert(self.Windows, windowObj)
    return windowObj
end

return NexusUI
