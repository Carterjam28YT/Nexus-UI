-- Nexus UI Library with Key System & Draggable UI
local NexusUI = {}
NexusUI.__index = NexusUI

-- Services
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")

-- Colors
NexusUI.Colors = {
    Primary = Color3.fromRGB(99, 102, 241),
    PrimaryDark = Color3.fromRGB(79, 70, 229),
    Dark = Color3.fromRGB(30, 41, 59),
    Darker = Color3.fromRGB(15, 23, 42),
    Light = Color3.fromRGB(248, 250, 252),
    GrayLight = Color3.fromRGB(203, 213, 225),
    Success = Color3.fromRGB(16, 185, 129),
    Error = Color3.fromRGB(239, 68, 68)
}

-- Animations
NexusUI.Animations = {
    ButtonHover = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    ButtonClick = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    FadeIn = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    SlideIn = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
}

-- Init
function NexusUI:Init(options)
    local self = setmetatable({}, NexusUI)
    self.options = options or {}
    self.Parent = CoreGui
    self.Components = {}
    self.Windows = {}
    self.Verified = false
    self.KeySystemEnabled = options.KeySystem or false
    self.Keys = options.Keys or {"NEXUS-KEY-123"}
    self.GetKeyLink = options.GetKeyLink or "https://example.com/getkey"
    return self
end

-- Utility to create elements
function NexusUI:CreateElement(className, props)
    local e = Instance.new(className)
    for k,v in pairs(props or {}) do
        e[k] = v
    end
    return e
end

-- Validate key
function NexusUI:ValidateKey(key)
    for _,k in ipairs(self.Keys) do
        if key == k then
            self.Verified = true
            return true
        end
    end
    return false
end

-- Key System GUI
function NexusUI:CreateKeySystem(getKeyLink)
    getKeyLink = getKeyLink or self.GetKeyLink
    local gui = self:CreateElement("ScreenGui",{Parent=self.Parent, Name="NexusKeySystem"})
    local frame = self:CreateElement("Frame",{
        Size=UDim2.new(0,400,0,200),
        Position=UDim2.new(0.5,0,0.5,0),
        AnchorPoint=Vector2.new(0.5,0.5),
        BackgroundColor3=self.Colors.Darker,
        Parent=gui
    })
    local corner = self:CreateElement("UICorner",{CornerRadius=UDim.new(0,12),Parent=frame})
    local title = self:CreateElement("TextLabel",{
        Size=UDim2.new(1,0,0,50),
        Text="NEXUS UI - ENTER KEY",
        TextColor3=self.Colors.Light,
        Font=Enum.Font.GothamBold,
        TextSize=24,
        BackgroundTransparency=1,
        Parent=frame
    })
    local keyBox = self:CreateElement("TextBox",{
        Size=UDim2.new(0,300,0,40),
        Position=UDim2.new(0.5,0,0.5,-20),
        AnchorPoint=Vector2.new(0.5,0.5),
        BackgroundColor3=self.Colors.Dark,
        TextColor3=self.Colors.Light,
        PlaceholderText="Enter key...",
        Font=Enum.Font.Gotham,
        TextSize=16,
        Parent=frame
    })
    local submit = self:CreateElement("TextButton",{
        Size=UDim2.new(0,120,0,40),
        Position=UDim2.new(0.5,0,0.7,0),
        AnchorPoint=Vector2.new(0.5,0.5),
        BackgroundColor3=self.Colors.Primary,
        Text="SUBMIT",
        TextColor3=self.Colors.Light,
        Font=Enum.Font.GothamBold,
        TextSize=16,
        Parent=frame
    })
    local getBtn = self:CreateElement("TextButton",{
        Size=UDim2.new(0,120,0,40),
        Position=UDim2.new(0.5,0,0.85,0),
        AnchorPoint=Vector2.new(0.5,0.5),
        BackgroundColor3=self.Colors.GrayLight,
        Text="GET KEY",
        TextColor3=self.Colors.Dark,
        Font=Enum.Font.GothamBold,
        TextSize=16,
        Parent=frame
    })

    submit.MouseButton1Click:Connect(function()
        if self:ValidateKey(keyBox.Text) then
            gui:Destroy()
        else
            keyBox.Text = ""
            keyBox.PlaceholderText = "INVALID KEY"
            keyBox.TextColor3 = self.Colors.Error
        end
    end)

    getBtn.MouseButton1Click:Connect(function()
        setclipboard(getKeyLink)
    end)

    table.insert(self.Components, gui)
end

-- Create Main Window
function NexusUI:CreateWindow(options)
    if self.KeySystemEnabled and not self.Verified then
        self:CreateKeySystem()
        return
    end

    local window = {Tabs={}}
    local gui = self:CreateElement("ScreenGui",{Parent=self.Parent, Name=options.Name or "NexusUI"})
    local frame = self:CreateElement("Frame",{
        Size=UDim2.new(0,600,0,400),
        Position=UDim2.new(0.5,0,0.5,0),
        AnchorPoint=Vector2.new(0.5,0.5),
        BackgroundColor3=self.Colors.Darker,
        Parent=gui
    })

    frame.Active = true
    frame.Draggable = true

    -- Close button
    local closeBtn = self:CreateElement("TextButton",{
        Size=UDim2.new(0,30,0,30),
        Position=UDim2.new(1,-35,0,5),
        BackgroundColor3=self.Colors.Error,
        Text="X",
        TextColor3=self.Colors.Light,
        Font=Enum.Font.GothamBold,
        TextSize=20,
        Parent=frame
    })
    closeBtn.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)

    window.GUI = gui
    table.insert(self.Windows, window)
    return window
end

-- Make library global
getgenv().NexusUI = NexusUI
return NexusUI
